:root{
  --bg:#ffeec9;
  --card:#fff7e6;
  --card2:#fff1d8;
  --stroke:#f5d3a6;
  --ink:#4b3044;
  --muted:#7a5a6a;
  --brand:#f4a63a;
  --brand2:#ffd27a;
  --shadow:0 10px 22px rgba(0,0,0,0.14);
  --radius:18px;

  --safeTop: env(safe-area-inset-top, 0px);
  --safeBot: env(safe-area-inset-bottom, 0px);

  /* ✅ 避免誤觸 Safari 地址列 */
  --topPad: calc(var(--safeTop) + 18px);

  /* ✅ 底部 bar 估高（讓內容留空，不被擋） */
  --barH: 86px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; padding:0; }

body{
  background: radial-gradient(1200px 700px at 50% -10%, #fff6dd 0%, var(--bg) 55%, #ffdca5 100%);
  font-family: "Noto Sans TC",-apple-system,BlinkMacSystemFont,"PingFang TC","Heiti TC",sans-serif;
  color:var(--ink);
  -webkit-text-size-adjust:100%;
  overflow:hidden;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

pre, .cardText{
  margin:0;
  white-space:pre-wrap;
  line-height:1.55;
  font-size:14px;
}

.hidden{ display:none !important; }

.app{
  max-width:480px;
  margin:0 auto;
  height:100vh;
  padding: var(--topPad) 10px calc(10px + var(--safeBot));
  display:flex;
  flex-direction:column;
  gap:10px;
  min-height:0; /* ✅ 重要：讓子層可以正確拿到剩餘高度 */
}

/* ======= TOP ======= */
.top{
  background: linear-gradient(180deg, rgba(255,246,221,0.92) 0%, rgba(255,231,191,0.86) 100%);
  border:2px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:10px 10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.topLeft{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}
.uiStatus{
  font-size:12px;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.uiBoard{
  font-size:20px;
  font-weight:900;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.topRight{
  display:flex;
  gap:8px;
  align-items:center;
}
.iconBtn{
  border:none;
  background: rgba(255,255,255,0.7);
  border:2px solid rgba(245,211,166,0.9);
  width:42px;
  height:42px;
  border-radius:14px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.10);
  font-size:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0;
}
.iconBtn:active{ transform: translateY(1px); }

/* ======= MAIN =======
   ✅ 這裡改成「可捲動容器」，讓 SETUP 時能滑看到所有板子
*/
.main{
  flex:1;
  min-height:0;
  display:flex;
  flex-direction:column;
  gap:10px;

  overflow:auto;                /* ✅ 主區可滑 */
  -webkit-overflow-scrolling:touch;
  padding-bottom: calc(var(--barH) + 12px + var(--safeBot)); /* ✅ 不被底部 bar 擋住 */
}

/* 卡片 */
.card{
  background: var(--card);
  border:2px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:12px 12px;
}
.card.tight{ padding:10px 12px; }

.cardTitle{
  font-size:22px;
  font-weight:900;
}

.cardFoot{
  margin-top:8px;
  font-size:12px;
  color:var(--muted);
}
.hint{
  font-size:13px;
  color:var(--muted);
}
.row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.scrollBox{
  max-height:160px;
  overflow:auto;
  padding:10px 10px;
  background: rgba(255,255,255,0.45);
  border:2px dashed rgba(245,211,166,0.9);
  border-radius:14px;
}

/* ✅ 開局教學卡（promptCard）在 SETUP 時：變成「一行提示」 */
.promptCard{
  padding:10px 12px;
}
#promptTitle{
  font-size:16px;
  font-weight:1000;
}
#promptText{
  /* ✅ 一行化：不再佔大塊 */
  max-height:none;
  overflow:visible;
  white-space:nowrap;
  text-overflow:ellipsis;
  overflow:hidden;
  padding:8px 10px;
}
#promptFoot{
  display:none; /* ✅ SETUP 不需要 foot 佔空間 */
}

/* ======= Setup ======= */
.setupCard .chips{ margin-top:6px; }
.chips{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.chip{
  border:none;
  padding:10px 12px;
  border-radius:999px;
  background: rgba(255,255,255,0.7);
  border:2px solid var(--stroke);
  color:var(--ink);
  font-weight:800;
}
.chip:active{ transform: translateY(1px); }
.chip.active{
  background: linear-gradient(180deg, var(--brand2) 0%, var(--brand) 100%);
  border-color: rgba(224,149,38,0.95);
  color:#3b2436;
}

/* ✅ 板子清單可滑：避免被內容卡死 */
.boardList{
  display:flex;
  flex-direction:column;
  gap:10px;
  max-height: 48vh;             /* ✅ 給一個上限，確保整個 SETUP 還能舒服操作 */
  overflow:auto;
  -webkit-overflow-scrolling:touch;
  padding-right:4px;            /* 捲軸空間 */
}

.boardItem{
  background: var(--card2);
  border:2px solid var(--stroke);
  border-radius:16px;
  padding:12px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.10);
}
.boardItem .bTitle{
  font-weight:900;
  font-size:18px;
}
.boardItem .bSub{
  margin-top:4px;
  font-size:13px;
  color:var(--muted);
}
.boardItem .tags{
  margin-top:8px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.tag{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  border:2px solid var(--stroke);
  background: rgba(255,255,255,0.65);
  font-weight:800;
}
.boardItem.active{
  outline:3px solid rgba(244,166,58,0.9);
  background: linear-gradient(180deg, rgba(255,236,197,0.95) 0%, rgba(255,247,230,0.9) 100%);
}

/* ======= Seats ======= */
.seatsHeader{ padding:10px 12px; }

.seatsGrid{
  /* ✅ 座位區不再自己硬捲，改由 .main 主捲動統一處理 */
  background: rgba(255,255,255,0.18);
  border:2px solid rgba(245,211,166,0.75);
  border-radius: var(--radius);
  padding:10px;
}

.grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}

.seat{
  background: rgba(255,255,255,0.75);
  border:2px solid rgba(245,211,166,0.95);
  border-radius:16px;
  padding:12px 10px;
  min-height:76px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.10);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:6px;
}
.seat .num{
  font-size:26px;
  font-weight:1000;
}
.seat .sub{
  font-size:12px;
  color:var(--muted);
  font-weight:800;
}
.seat.selected{
  background: linear-gradient(180deg, rgba(255,236,197,0.98) 0%, rgba(244,166,58,0.25) 100%);
  border-color: rgba(224,149,38,0.95);
}
.seat.dead{
  opacity:0.55;
  filter: grayscale(0.4);
}
.seat.godOn{ border-width:3px; }
.seat.good{ box-shadow: 0 8px 18px rgba(32, 170, 110, 0.18); }
.seat.wolf{ box-shadow: 0 8px 18px rgba(220, 70, 70, 0.18); }

/* ======= Bottom bar ======= */
.bottomBar{
  position:sticky; /* ✅ 讓它在 app 內固定效果 */
  bottom:0;
  z-index:20;

  display:grid;
  grid-template-columns: 1fr 1.3fr 1fr;
  gap:10px;

  padding:10px 0 calc(6px + var(--safeBot));
  background: linear-gradient(180deg, rgba(255,238,201,0.0) 0%, rgba(255,238,201,0.92) 35%, rgba(255,238,201,0.98) 100%);
  border-radius: 18px;
}

.btn{
  border:none;
  border-radius:18px;
  padding:16px 12px;
  font-weight:1000;
  font-size:18px;
  background: linear-gradient(180deg, var(--brand2) 0%, var(--brand) 100%);
  border:2px solid rgba(224,149,38,0.95);
  color:#3b2436;
  box-shadow: var(--shadow);
}
.btn:active{ transform: translateY(1px); }
.btn.ghost{
  background: rgba(255,255,255,0.78);
  border:2px solid var(--stroke);
  color:var(--ink);
}
.btn.main{
  background: linear-gradient(180deg, #3a3550 0%, #1f1c2b 100%);
  border:2px solid rgba(255,255,255,0.18);
  color:#fff;
}

/* ======= Drawer / Modal ======= */
.backdrop{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,0.35);
  z-index:50;
}
.drawer{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:0;
  width:min(480px, 100vw);
  max-height:72vh;
  background: var(--card);
  border:2px solid var(--stroke);
  border-radius: 18px 18px 0 0;
  box-shadow: 0 -18px 30px rgba(0,0,0,0.20);
  z-index:60;
  overflow:hidden;
}
.drawerTop{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 12px;
  border-bottom:2px solid rgba(245,211,166,0.8);
  background: rgba(255,255,255,0.45);
}
.drawerTitle{
  font-weight:1000;
  font-size:18px;
}
.drawerBody{
  padding:12px 12px 14px;
  overflow:auto;
  max-height: calc(72vh - 56px);
  -webkit-overflow-scrolling:touch;
}

.modal{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,0.38);
  z-index:80;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:12px;
}
.modalCard{
  width:min(480px, 100%);
  background: var(--card);
  border:2px solid var(--stroke);
  border-radius:18px;
  box-shadow: 0 18px 40px rgba(0,0,0,0.22);
  overflow:hidden;
}
.modalTitle{
  padding:14px 14px;
  font-size:20px;
  font-weight:1100;
  border-bottom:2px solid rgba(245,211,166,0.8);
  background: rgba(255,255,255,0.45);
}
.modalBody{ padding:14px 14px; }
.modalActions{
  display:flex;
  gap:10px;
  padding:12px 14px 14px;
}
.roleLine{
  font-size:28px;
  font-weight:1100;
  margin-top:8px;
}
.roleLine.small{
  font-size:15px;
  color:var(--muted);
  margin-top:8px;
}